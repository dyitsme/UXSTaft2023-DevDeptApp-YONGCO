<script setup>
import Navbar from '../components/Navbar.vue'
import Card from '../components/Card.vue'
import Footer from '../components/Footer.vue'
import { ref } from 'vue'
import Clipboard from 'clipboard'
import isUrlHttp from 'is-url-http'
import 'boxicons'


const originalLink = ref('')
const links = ref([])


function shortenLink() {
  const url = `https://csclub.uwaterloo.ca/~phthakka/1pt-express/addURL?long=${originalLink.value}`
  // check if the url is valid
  if (isUrlHttp(originalLink.value)) {
    fetch(url, {
      method: 'POST',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
      },
      // body: JSON.stringify(data)
    })
    .then(res => {
      return res.json()
    })
    .then(data => {
      console.log(data)
      links.value.push({
        'long': data.long,
        'short': `https://1pt.co/${data.short}`
      })

      // reset form
      originalLink.value = ''
  })
    .catch(err => {
      console.error(err);
    })
  }
  else {
    console.log("invalid url or no url provided")
  }


}

function copyToClipboard(short) {
    navigator.clipboard.writeText(short)
}

function removeCard(link) {
  links.value = links.value.filter((l) => l !== link)
}

</script>

<template>
    <Navbar/>
    <div class="intro">
      <div class="intro-text">
        <h2>Create a Short URL!</h2>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis leo ipsum, dictum et est ut.</p>
      </div>
      <img src="../assets/img/man-working-on-laptop.svg">
    </div>
    <div class="input-group">
      <input class="input-link" type="text" v-model="originalLink" placeholder="Paste a link here...">
      <button class="shorten-btn" @click="shortenLink">Shorten</button>
    </div>
    <div v-for="(link, index) in links" :key="index">
      <Card :long="link.long" :short="link.short" @copy="copyToClipboard(link.short)" @remove="removeCard(link)"/>
    </div>
    <Footer/>
</template>

<style scoped>
@import '../assets/main.css';
.intro {
  display: flex;
}
.intro h2 {
  font-size: 4rem;
}
.intro p {
  font-size: 1.5rem;
}
.intro img {
  max-width: 428px;
  max-height: 428px;
}
.input-group {
  display: flex;
}
.input-link {
  font-size: 1.5rem;
  border-radius: 10px;
  border: 1px solid black;
}
.shorten-btn {
  background-color: var(--primary-green);
  color: var(--white);
  border: none;
  border-radius: 10px;
  min-height: 71px;
  min-width: 210px;
  font-size: 1.5rem;
  cursor: pointer;
}
</style>
